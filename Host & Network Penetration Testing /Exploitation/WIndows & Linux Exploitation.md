# Windows Exploitation

## Windows Black Box Penetration Test

- A Black box pentest is a security assessment whereby the pentester is not provided with any information regarding the target system or network.
- The objective ob a Black Box pentest is to accurately test the security of a system or network as an external unprivileged adversary.
- This approach is very useful as it demonstrates how an external attacker with no inside knowledge would compromise a company's systems or networks

The following diagram outlines the various phases involved in a typical penetration test.

**Black Box Methodology**
- Host discovery
- Port scanning & enumeration
- Vulnerability detection/scanning
- Exploitation
  - Manual
  - Automated
- Post Exploitation
  - Privilege Escalation
  - Persistence
  - Dumping Hashes

![grafik](https://github.com/user-attachments/assets/5b4d241f-399d-4d20-b1eb-887ba43bb3a9)

### Scenario & Scope

- We just began our first job as Junior Pentester and have been assigned to assist in performing a pentest on a client's network.
- The pentest lead has assigned us to gain access/exploit a host running Windows Server 2008.
- Our primary objectives are:
  - Identify services running on the target
  - Identify vulnerabilites within the service
  - Exploit these vulnerabilities to obtain an initial foothold
 
# Port Scanning & Enumeration (Demo)

## Overview

- **Port Scanning & Enumeration**: These are fundamental steps in the information-gathering phase of penetration testing. We use tools like **Nmap** and **Netcat** to identify open ports and services, gather information about the target system, and enumerate potential vulnerabilities.
- **Goal**: In this demo, we will perform a port scan using **Nmap**, enumerate services running on the target system, and import the results into **Metasploit** for further analysis.

## Demo: Port Scanning & Enumeration

### Step-by-Step Process

### Step 1: View and Set Up the Hosts File

First, we check the contents of the **/etc/hosts** file to see if any relevant entries for the target system exist:

```bash
cat /etc/hosts
```

### Step 2: Create a Directory for Scan Results

Navigate to the **Desktop** and create a new directory for the target system (Windows Server 2008 in this case):

```bash
cd Desktop
mkdir Win2k8
cd Win2k8
```

### Step 3: Initial Nmap Scan

Perform an initial service version detection scan with **Nmap** on the target system:

```bash
nmap -sV demo.ine.local
```

### Step 4: Detailed Nmap Scan

Run a more comprehensive **Nmap** scan to detect services on a wider range of ports (1-10000). This scan will include service version detection and script scanning and will save the results in XML format:

```bash
nmap -T4 -PA -sC -sV -p 1-10000 demo.ine.local -oX nmap_10k
```

- **-T4**: Aggressive timing for faster scans.
- **-PA**: Send TCP ACK packets to discover hosts.
- **-sC**: Run default Nmap scripts.
- **-sV**: Detect service versions.
- **-p 1-10000**: Scan ports 1 through 10000.
- **-oX**: Output the scan results in XML format (for later import into Metasploit).

### Step 5: Access Web Services

While the **Nmap** scan is running, we attempt to manually check the target's web services via a browser. 

- Enumerate port **4848** by entering `http://demo.ine.local:4848` in the browser.
- Check port **8080** as well. Note that it might not have an SSL certificate.

### Step 6: Banner Grabbing with Netcat

We use **Netcat** to perform banner grabbing on the FTP port (port 21) to gather information about the service running there:

```bash
nc -nv demo.ine.local 21
```

### Step 7: Analyzing Nmap Results

Once the **Nmap** scan is complete, review the results to gather important information such as open ports, service versions, and possible vulnerabilities.

### Step 8: Importing Nmap Results into Metasploit

Start **PostgreSQL** and launch **Metasploit** to analyze the **Nmap** results:

```bash
service postgresql start && msfconsole
```

Create a new **workspace** in Metasploit for the target system:

```bash
workspace -a Win_2k9
```

Import the **Nmap** scan results into **Metasploit**:

```bash
db_import /root/Desktop/Win2k8/nmap_10k
```

### Step 9: Enumerating Hosts and Services in Metasploit

After importing the results, list the discovered hosts:

```bash
hosts
```

List the discovered services:

```bash
services
```

### Step 10: Verifying Hostname with SMB Version Scan

To ensure the hostname is displayed correctly, we run a **Metasploit auxiliary module** to gather **SMB version** information:

Search for the **SMB version scanner** module:

```bash
search smb_version
```

Use the module:

```bash
use auxiliary/scanner/smb/smb_version
```

View the module options:

```bash
show options
```

Set the target IP address or hostname:

```bash
set rhosts demo.ine.local
```

Run the module:

```bash
run
```

### Step 11: Verifying Hostname Information

After running the SMB scan, verify the host details:

```bash
hosts
```

### Conclusion

What we accomplished:
- Performed initial and detailed port scans using **Nmap**.
- Manually checked open ports and services via a web browser and performed banner grabbing with **Netcat**.
- Imported the **Nmap** scan results into **Metasploit** for further analysis.
- Used a **Metasploit auxiliary module** to verify the hostname and SMB version on the target system.

This demo shows the complete process of **port scanning** and **service enumeration**, helping us gather the necessary information for further exploitation.






